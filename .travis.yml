sudo: required

language: python
python:
- '2.7'

services:
- docker

before_install:
- openssl aes-256-cbc -K $encrypted_7ffbbc34c1fd_key -iv $encrypted_7ffbbc34c1fd_iv -in deployment_keys.tar.enc -out deployment_keys.tar -d
- tar xvf deployment_keys.tar

before_script:
- docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
- eval "$(ssh-agent -s)"
- chmod 600 deployment_keys/deploy_test
- ssh-add deployment_keys/deploy_test
- chmod 600 deployment_keys/deploy_prod
- ssh-add deployment_keys/deploy_prod

script:
- export DOCKER_REPO=potic/potic-pocket-api
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH | tr '/' '-' ; fi`
- docker build -t $DOCKER_REPO:travis-$TRAVIS_BUILD_NUMBER .
- docker tag $DOCKER_REPO:travis-$TRAVIS_BUILD_NUMBER $DOCKER_REPO:$TAG
- docker push $DOCKER_REPO
- if [ "$TRAVIS_BRANCH" == "develop" ]; then ssh -o "StrictHostKeyChecking no" "$DEPLOY_TEST_USER"@"$DEPLOY_TEST_HOST" TAG_TO_DEPLOY=develop ENVIRONMENT_NAME=test POCKET_APP_KEY=$POCKET_APP_KEY 'bash -s' < scripts/deploy; fi
- if [ "$TRAVIS_BRANCH" == "master" ]; then ssh -o "StrictHostKeyChecking no" "$DEPLOY_PROD_USER"@"$DEPLOY_PROD_HOST" TAG_TO_DEPLOY=latest ENVIRONMENT_NAME=prod POCKET_APP_KEY=$POCKET_APP_KEY 'bash -s' < scripts/deploy; fi

env:
  global:
  - secure: haMd0MXxIJCfkKqjSSl7nt7EnAPwRQ2ISDkJKulv1cf88J6a1yh/TsxJn9SrYDXbjVgxWMPb/J0JduDIhmcTvxSZ87G56Pb2DBTwUAl2n+PJSgkoZAjwDKs0gzg89+fqI9MmNORtoqIqQv4LNtnO8mIiaV730UIfFmIJaJoPGDrBmK43Y4o/1CHlKQuWw9yi7WqCBb4MsQ7fzh2o6k8N1fWp+MgAQPcMcFE17oLHOvXFrlLWLhfvWDWLlWgA0qg/E0h0SeoX+D5Ggi9mKZpskd9rYoDT2vJoGHD3rh2tqRcQkV/oLWyyw4eExGZzMM4SlJQ0C2XfYwCC8u9woTW/e0rA/28Ww+kPGL8Fy1GDSJO78orPHojT7Ldh7Q0qZ5lPVwaAsbYsNT9HLFC/Cn5GJXosg6w5VTyOPhLzG1irxFE0ZKFFZDZt+/dnxN8LmCZDcdgvmOdEinrZC5fB8kuYEPZvzxIzQz6o8tlkuIhMZ6VEbMYtb4UvgomECcC8u/Uy/wVdur0kU7Wo7xmOszKl582DtVOzsEfjJ8MphspOhMeZEQQ4kJE71LvRVk2ekW+s07R2Ifx5tFwlDz+0d1xQSm/rbI6nk35DPUDIjPOrgXZvThM8bdikp+4Fa7drEK4iEdz2jMmfaY/V0ZNyviLYV5MdyKCFoInl1BsT340P3aA=
  - secure: BXqR9bPE8vO2rDMQiFHdGZiP+uriX2ZSxcxJZE/m2reetBD4IRmn4JVsjDIVAWnwLmjIQS3NLh1aijAWSrBWmPY6+xL/TcBt1K4fn4SjwSyQfYG7y/I+qeXtpQ/RKSgIAWBqPlizeHnFPQ5qtCoCPkYjjfzNvKYh5qkqMcbMNEe3u/IFcoknrM+0svOI+xD5NFc1ni8+AWGEAdbn69H8Rpl8WSnus0zHui5kIeaQVaGzfL5LpYJjftlxwqWb4sqhLRRg7GHBgs10pgphDgDfT2fRtSvhZGhH6fEtvUpHXsXdbvfFbgjbokfMFb8M9bKfZMAiEYqqyFtR8+RSQvRU79VXzif8U2Jy5qx5XBRll2o7F0Hr8jIiimkrD/WQ2S3tU8dGgqrykurRWtjozONay9N2LC3OSZnBxpOdKyjQWpG4i/Y/dHdaIm4O1APp+4qVGeA8LObv8VBHiX/frjH8IWTN27hWFzKf0ow1b5ykfSFlXRoh7dcGS3/3JWrZXX0+HY6bW/4K2ro1GN1WRJbTsfC20cpGt4F/8XAhyJLeVkRiDh/EaMugWV3Sk67HqhCibzPUzNaVKdhN5bwSnE8GlpFTT6lynGhGATiElZTOP931lFqlhbY9Vvw2UNTjwXyZp+fapfaYE8VD3JfT85Fk8RUTLnBIo3FSRUWJ2AGG4PE=
  - secure: vAe0SBplIW8xGi78kwXtBWymmHsig8pc545cWHlNLz/eorJhCxtAimS0e/RmDIlv3yQT/pf+DT1guIGdVeJEQ5/IiWdocJpziqaDLGjvt/A+rUzBnUsKivXqH3Upyc/PeOVTW0RtJDB59TUOa0VOrV3Ne9S9eDV0pviAE0dBWNEfjwxPltU2SJiX8OeLg+5c8G/uGN8Xs2i4UBbI8Oi2YETmjdHpS2vqQTvOHasa326d5zlhjaYeMyphd1r13dGsRwo4n4MbH1HcFitHZM22XxnjEeDQPHzGYO6aKUPnSD2kAFp+FNogGTrbqWVWWMy4blkQE7tYjuajrubxAoffU7RcNT+p63PATLrZM3SxA5hbp3j0J7POxXYTufJyEAtEpuIHEa1OsdLSHbOH3Yb0UqkBksgCQezdWjnELh5Jhbr5Xm5hUkJChyvC/X91j+FKKxT4+Uhyn6ni/2hZM1YZu4VI8AdLWLPyuUrYd7tNGV6ys+WqZcNMSm+tfB7RrTDqgSzOqPUELLhOOETBBD80aHCGOMWhr/Bw9sukk7YnepUx+oVWB+x5Kja/8KCLZTMAvgcuYl5fW82Qg3NDJtAFjuBLJwSJOUhSHadpmxeM1HYuROT0laxQl2idKy48s9sUcHenFIsAD6GsiDT35TBzGNc+NzQOBu028bb6q8MphUU=
  - secure: lJM+Uo7I0dm9Ao88P0kBbcs4nAa2holAjgIWnOLlFnUCR4N1ljRvyA52UYBQUuYxd1p71o+hi3SMch3i59CLO503TnpKidglrZjb8ut1mrR0m8fQqRJJDWJkUMJKymxL3K6h2TxdFmzzZ9UxJOfJ4u+SYqnucFOIPI9D+uChCoeq+5Zqknukhf2beMKusFq28jNP19hd6LmAdc5jQ+zbEHDVEkc7j/qLgQnhoBrHKnyk/GKc9P/1SVK8qMluEd4b5g5rFPTCYYxEJdNKNVx1yV35VOH96Qf3536qG37tM3IAOeUehYZ7SvLnb0Xi5GvwioljMP7UNB8rMY71G4CWZFRF68kO4KJL3KUREbyLVHjTOv0lKeID7/YE1wptStbvOJHvXmvBvsUorr7PTz6KV1Z8O+g1FCig4LBDlg5mxR006msOvVGKMJHfCrCl9cOHqs+vXmMfCsPyuoGZ/9rgNEUfzH6O3K03c5eJMslitihzBjVBIbfcumT78Nd4pqz3xtcz4q8ZLWu2d1/LdHMXjKVd3yc8u/+TgAHyR7L0iwC/zEIhbc1MxeYtxYEUxmT9Uy3SPxTLCgYZkQQfmL4u7s/7w+CBUzls4todnDP6tbax3nvcoCB3DEKsVM/3DUWG1s8HZAQyQUzf3eLtyv4FWr/ewjz0w0dRAaHA9gurIlE=
  - secure: ofBpTzJXTaqB7ZidSxujEBWY3YTYYT9ge7ByIRHZKsdV4Dk9pVyktueCYhxtp4FaYanC4ro96IYpQU6UbYCmSL48QRMxzlI3ra/7VbpaXEudOkEmcpNRJxrDL8QDy3At6u9SlhhyUTaTEWOFKXG7xihy3tB++bq/HeNGiFJBLow5AYpGBpwpRw5al9zc+UfRNByAeSAExjDhaxo8f2ihRYy2GuHD0Rm0Qhoci6rYNd9NE//AfAsuJeLluNnBNahA1CyikN5kd98CEbO9qK8hE41XxK6WOpizAJMTa9xHDUi31cz383Yi+Wi0DWJRBNW3tLt9pjcuUkWRS3o3Opqsyw2u5AclvMixb3B2hT35EqUoYG7rEZkjy7Y10DuPgVutqNpS6c8JNC4pQou7jumlDkB6Pi0FoYXvt/pdHBkJfig0x852ViHCelEq+rHCK445C+KK51bH3yldSUPzG6PqRxV7PBKy8tP1l3uy0Pzlk4xuVgdRkT3vx8YRmBpMUlCtymUeEETd/kaaxz2KZZ9uNkgjAgNqhr7vj1BdhC4Qpu0F9dnqYEB6rnmvd7MCL6lWf/ggxqIm3BWV+G0iVfuBl0gvsGR1qH95CKz5beSs2beCimRwZxkWiOASOSeFsZjy+vINGIUeoMZZKXwvDRNQ69dTu9fjTWT74YvrT8sW3Yg=
  - secure: mrELX68qIqnr4cNaScv5mfBhrpjtJldO3h/gds5Vv8whcYP6CSF8MZZePyXxTrYaELj2DhF+67CJwOe1CaH/uXXDYHKzikzoYbl6tUVV71ZjIWIznOcbsipsnJJjB5/UdLav5yAFQbsWuZpr1dr8v1nVMdrIj70CkkjALGehT4nky8ddnn2vGjqgPlFvAiq2+PG6NesFMWFc5fggMWefM6uAYk3L96WlYbU25hVW0i+EKuI5HmXIpy1cWB8XkP53cEn6W+c48YXbIgsVEyzw0X4IKkLEZWCyyoRzgSaYoM/+aZ5vJgUvePEArrEmpn+y05bC7KVlW6gTy+/HNlTexjFL1WmT3LvCoH3JQ3HVTlqwFv4r+WmUtNWXDBYoNsyHR2I5Odv9fN/oy2+ifIaBISOz9aBml5+Bn62CgrDivOO2R2LjOJVgUQGSm5Y2mRnpNi7V68peB/v2RbsiBcRXXcRB+11sYGtlylgaoXCZX8F/b2oj9A98yFBYXN3U1Gf/19D2uATozaNpwVXB9El9HkfFjvSXTSqzKwB4hM/Iy0XqcVIB8zvVs1yBMBfA6MlI2iDG7M92wh9Q1yYVip2qMtSy4KJ62UaS3y90spR03MXJlC66ZwsINIc3aK5rHtUMDtIvK21gqTMisFxxEnxEn7uU/0Q9qs+QAlfj0BNn5jY=
  - secure: rD4sPqPYmMx7NGz85MDezIMET6lsfhuF3Knch2gWX0WgBrPNxZrcyF3BcOpqn3eaTavG7A89h50XhmEMguFf4C9WdnXmGERNGbyMmsnIgV6AyCEo/3xnpCq0mfe4kUFglIBVQCOLqpQgRgQCKCts+9YxM/VEdVSbI+2pTwFZW+SAERelBmQkqkVQvHy2jwLjAMI1BDgIqP2/jcMwB1pAtP2Psdd3yPHEo5pLk4cw9KC8LLj3AoAxGPlm+MywRElC1lz5mw/qlUJ2epMrvlxPyZ9iCG5+XyIMLdxQdcPkGtlLdqkqE/1X8PEql4+0WtFI7bNX4HQ5lEE81WpDgEsIX0GfAluEk4QN47T9+UA2HpjH+bqQIveeRrFKhIqLZGgampS4FWEe5Yjy5ga6HW2W0Ki/g1o4MhezQC/S0Yd9PPNZRGchvOuMENGemSu3D0dS/UjnWfD9hbBxkTtJ+1Nqx+6xoINgHoVv1oJkO8tOZFyTt6imX7PqPohBZI8yBGbB0+J4jd0E5n5D3mgybNY5U/g5rKtwsR2w1fIZhPlzzEsrzQursqWIlhl/qZPbMkxjXCW9W/3TlToDlB+lUAQfS/1w+qPuo6mNuiFgwY7fjGaUWan6W1RVzj8ortyzHPOK+KLGD7LU1amN4NNnbge1EwnoWyEWztyY6xXZoCFllvs=
  - secure: OjbcH3INgqO8NIgQkuIdscdoOmqyhDxh84pjQZAn4w12FRXW9nlS7sQJf3h+vpLlZ/9sfbNeE517LTVygnQAojJgKb8K9KOFTzWxidxoHNe4B/qiNwoLpCkMVgF+cUm0pNQ4TQOE8eYxWU3FCxF5CtorKS6XIChxp5A9Kv4QyurAMzQ/V1bGwnFD6Ob33+sKW5js3DDgPqOqY6kA+qPEWPTrYA2drfclDYeyrn5zx0P5HzWXEzXWwzjN4r68WQJyBStmCCFV5rkHAIsXvObEQKc9SpBYG9lHYyG3HS2s/7JVIQh4KACjhjBMDnxazumZ27HBJvAjVYrpgvmtU2sKaBa969b+wCWZ1SVZRvcZRAX5RqFdj+KLOQ68lwD4Mfno3xU8SZ/e7TVEH/pHxnXC0Y/tsobuQDb1Y5CvQ8bWPpIB8HXJ43sqLgd3ebYl7dOqJoAVcfSRXl6wHrkQFP+78V/yQroSE9ebQ+RyINJP2kEMNs1i69OFheDwl1CcAeMF5eyjlxarSGLPea53BOI/JgeKoA6gVEPMrxOkICtvciYgvBevaFd6Iu4nPg6PiG+6r8i1culSaGd28eQWtDwyCezPqMxDMGB3HruXU/1Ro0X0DCvaxXQf5ehYkyMoxd/EEdFywRRyFVAUnzIBNVpMczp02e5+0gQfe2dA4CDE3j8=
