sudo: required

language: python
python:
- '2.7'

services:
- docker

before_install:
- openssl aes-256-cbc -K $encrypted_7ffbbc34c1fd_key -iv $encrypted_7ffbbc34c1fd_iv -in deployment_keys.tar.enc -out deployment_keys.tar -d
- tar xvf deployment_keys.tar

before_script:
- docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
- eval "$(ssh-agent -s)"
- chmod 600 deployment_keys/deploy_test
- ssh-add deployment_keys/deploy_test
- chmod 600 deployment_keys/deploy_prod
- ssh-add deployment_keys/deploy_prod

script:
- export DOCKER_REPO=potic/potic-pocket-api
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH | tr '/' '-' ; fi`
- docker build -t $DOCKER_REPO:travis-$TRAVIS_BUILD_NUMBER .
- docker tag $DOCKER_REPO:travis-$TRAVIS_BUILD_NUMBER $DOCKER_REPO:$TAG
- docker push $DOCKER_REPO
- if [ "$TRAVIS_BRANCH" == "develop" ]; then ssh -o "StrictHostKeyChecking no" "$DEPLOY_TEST_USER"@"$DEPLOY_TEST_HOST" TAG_TO_DEPLOY=develop ENVIRONMENT_NAME=test POCKET_APP_KEY=$POCKET_APP_KEY 'bash -s' < scripts/deploy; fi
- if [ "$TRAVIS_BRANCH" == "master" ]; then ssh -o "StrictHostKeyChecking no" "$DEPLOY_PROD_USER"@"$DEPLOY_PROD_HOST" TAG_TO_DEPLOY=latest ENVIRONMENT_NAME=prod POCKET_APP_KEY=$POCKET_APP_KEY 'bash -s' < scripts/deploy; fi

env:
  global:
  - secure: eUSmPz6A96emSW7YQSvZKkhW+8xyr9otF1oMUAd+m84ENrYzyZorhK9iU5DyzI1uPhnPYseSvuyetKpeiIdfe5sezS6Hn8bqm/wsfTlQXO0STQV3a6DDEehntHBILck2S0iozcm7t3zd27COm54U/HWyr7Ja/ICm1QpxX2anBpCZs7v1NGKVRQZwTwLO0nG00Up6/IxoAUSBnkG51nsR8tJTneX+LZDmjK/DcujF1sM1cqAxKuQGbGMwkwh6WBQmwXjNTSTnm8B/B+7+0lTQgU1I0YFI+gwhcghlDlPoWATJaEIfBrwgISc3q3mud9RbKO3c1EaOUna51D1IBY4wZyMXhyABxyfVE7Kgv63S7Ns4O31P7oC5iDduyB9DtDdo3DKEHNFePgWHlpA/ed0VXLNFWtctjfAa+gJlG8Ki79+yKT2P9juick/rwr8VQfk/tOw/0++7cFl2UhowLQ98tqiFSPhkkCDlgygh5zMbN7kmXDToeliYt5PtSdehP99E2kys7qgVqY47M30quIez58eGmWL9dDGECYKhKECNflvp6FmFwT7fRyT9CDZ5b6qpHoKuaCdet8PYMbBhZnEgiVAExTGbuoTv4iDNaQrouPnqHr53HzFaIgvd5oI6V93hfNFVpJ40K4IkMGG2VlDNElyqJKYgBz3nJReEczjCe+4=
  - secure: ZkCEvm7M563zWdW1RzPGXgQIw+6uCrYxuSyBQyBK682nlpV2mJg+mnPQCER8Iclg97VwHIKb7ojvzpx2VoQ3qI5/zPWQtTzLN+1vPi/MgkZ+NSizcKzpu3rJarsnJebp8pljp8yTGEw7G9G5de91YHidZcUbNiTEv0UomrziDtB3Yw4ez2IBiD39O7VgM1OT3jJosHy+JCMAg0ZnoloeoeUXNqTLqPRICP+Pa8d7wlmJK0rJP4xdd65dNBcn6+XllRFmS4sPcrQRfSfChdGKI5rvKFD7ibcMwG/c1o3U7RSo/MAZE6j7Te/hjY9zboOUrpTzWPte7icEMLIHvUtKbAtMWtcYLwHSA3G8sKHb4our4lXQTOgvjJuP5qIJw3WHOOnQb7GKCwUPMfLrMVwWlAIQmu+ooMwD/7CdfYV2hxRakbC4elwDlwwM1iHnNMoFlotgD0MylfiHEZetVzEQlhIcNkSLaWIw5A3OtZRpqJZOgcASadmMpsGB3vEl87xnpH3QPN/Ld605IY/ZHiNZHcOm4/RV+fn0qLRs6gv533mIUSLLYccSY3uVg4YnP7TK747LDkFcNlkuV/DGhciNXPM7Kiu4peghT8pRlfXj9g+jpyBFYAAeYuLyqWi2X3BJk3xjwYLLFaTPvRPew/nHp/7ec3OCWjvjAit/jcxZL4M=
  - secure: eYk8dITCGhABYJ5Et0EJ6VK9wN9hW0H/ABX65l0o10nm5jSLfy3ojckhotjWEoMMiGLIwxhgoJTRV3+dhNMR6Q3a98GwmCm5RUrkEhHy1nYW0yyHNbuAs7BtywnsXHWdx84RnoYMuoZ4szF/F8eItcQxjAODvG77vpOPYXBMSXbxLk6iXszKgp6YyZLGpMdJhqngyJtAvaTJZyMXP1Zh0g7t1zHH/kMxMDcLbKPIqVMzgrP8y24dmDQaFT1lovlrLWuda9Y20/k6Wl3WYzh+Kfn4TvyJqayOBVFBsZM4KgCu9mO3rS/p0TCmazwQ1/idefdWGn9KTLMZxAQ6UAGOxIGG2QDsosuqjOUR81zS6dmlOIoVP5mQAnvrpFp8OZ4oKtXSQfGJ1vr/yUO+3hzDAJbDIla3oPl2H8fnamo9DxpaBmUghXbo97N8H6k3Zfp+tvM4IjzT+IEWSLyARAIf1l5NmqEJGFOGTfQXaMG4RRD1mwzai0qjWtG3BVLs5++fWGv3ggAzEzz6hPzrdUXIV9jNyqJD4ysDU+fXTeHsfgBRAu51RsWl/1XBkoMqG2QwWV1xvbOFRrR4FGN5f6u3pBtIzOTsffVqIiJBY1O4nJGSAIHAtl9qjedHMIESVgdPHi+4Abk6jOkhWxYEaIuJXfDtB/dnaEJmTgQulDGxS5c=
  - secure: vStNMjtyXP90ww1lhmIO7hh34ZXSVdsD16JSVtk3pYtobvhCaONl8dnK+/Eo4RbFyXOcuSK87AzgQ7MVyzH7RX8m3BiGM+k11pMN1hQOiplrKBHOPBxjHWpbV2JAUHnq6iK8lVnr1G0QeDck0fQuBC2hqfKQdtJ4q0cO4l4wg6NRKzPI7uMHFnAmanJjfM0fmKOHAL6DEdYn9TC+H0K2Tg/i8p7vmMOQMVoRmn4QWByWAfmNUilb/jsf/LGtosBZnFc1O32WKO3NiDqwyumVUleHhG1oc/9z7g0i2j0xxcEKTesgWPbYHnCgkEVeIvl9K1BYpreYdi+KuEPGuc4JYow2wyzYOwd/ipDqTaDUMxqv3wtagX+bwuoYa96rx/iIoK1nS6yUuW6f4EvRh/cwKRmOi8vvbrzFeDuaat7DoB/Fz/ZaculdyKSqo3zikHRKxUb2ytoisCoCje4Fdofcwlm6IAX2MBkoivfwGSq/FRUrM5kWYvNWJHK/+SbZn/iKo86lDiF+wQolTYRGyo+17IRgdJ23cffcBCrI/bbR5phX8LAXywQVKlvsRty1EMWZiD0mY6098JytejOIEgRvUmAjoQ8MWHA1kzm/NkW9fk5G9MvaNeVBk9dXwisLBD0YaWBaIaCBwuN/+iZDvoNkkSUWXQcAOlGTZ0h77qs2A6M=
  - secure: SdZDeGOvy5KRgjTyUXydERJtQvlsl/FateBZG5DCqGBe7ro8Z/ipf/18sxHBwB83k1ey2TkG7vxZ0el3TjTKxVhyZeUOs/C7mBTf4xo/LzMrtn+YZparoscWprm4gQCD9Cm1Ifw+6frwnbYlUIItxejdPO9coMgjf6pyhLeR1sT4/fAxq5wlKpOlsdsVwP/HJM/wcVuCBnsGTrkAZLU89hmkJaUld8GtVLnSNDDpWV/EZcU6lPmEOmhYaN6mIXrsjrP+7CbwdSmeA7FiftxmJTmzdXMDzIjReeyJIMp2KeFnf9bJVNlrJOqDhfKDTnNsa1yEu5rWo5oXmCi1jwQZnyTNJ3HDjieCBRpl5J1tIWvhOU5xEwoIgPJLH6Um49lGFqjSbWafHswWuUBgpPy8VCmInpGPaWdVS9S/bAUYrqudgkrWd/EiqYkOEdrLryDNq3JzESDgVD0Gs5x4mLRhHnVkUNdczeEP/q6Zr0BpfjmV8EJsC3FKnffYHub76qenFOPtXYcTeH/xxbId7/WxpMGhBQd6As9AXQw3/cXAwhHPGmFSrVwe9yCw99ASBgf8tZpzKpTURYHQQn9+CN7f3MVGBbz9VepYB5YiWxqcUfQbKaraYfRr9dMhmceBAUGxgDZKFQ9SPLHir6SJZprH+1rBL3IiNXl6ejvL+l638z4=
  - secure: WI0cX6ebrd7lhiya6wQ1/DLrCgRNC2JmUH5TF9uFTYZCIEqJiv24SI0MaCyzNTXzQd3xDqJeUhI1+xqJknyJfj4E/Y0X8fc5ot00UY79JaUlUKrHL+lIF0DeQXcMby2rjm/phtNhlepQqV2xS0BR28NPPuz8CpwtuEQZsbmsWCXPwmkUnjxUy1eXFp/H+3mhuxZvn+8UqfysgHMeXzHMTddZRaY/BBDqqgprqq7pNrtiGb4e3Ovi0iFO2N8Qy93YJ3X1b/ytwxAI1dB+Q8BFIxY1NiDivqBVGElbWa5rHpUTa6BkPmt8vAjiMCVkOTOn+VP+VSNYqZeunqViDcLmzpX//GZI0R4UyBQZ2ph3V30XVr1YmSXveffRmRwMu/k4d43Gru4X38AdbJHFlH68y0I4wvlCLdQVeRwi7CL6gOMBselEEXkAgPEiQt5vriC8vb5/lDzYzV9nO4IbEIskVwR9Xed0DBDAK+hVfNSAUeQUq/UNKE9m+JvVrBoQtGFnqN1JZ8w4brg7o+sfYO0SmG+koFa8X3xnmPF44NO+NoYxK0OAGwc26WiXoKX+ZYz1F+tRaGKVRenKYgrK287N2OrvqabRBFK3v5cHg57s1+7CL/dm19g+0YHLpUqRSsfq2yR9XzHBZlS+wjCe2kuOGAG3ml7lQeHe6vntecXaX3M=
  - secure: U8Nx2ykH+fW0zujlU/t678LhuBEgcRmD13bWeuXipQsELPSSf1+M9IHmKt44NobUkYCxSlydgcWFQBYrg25vmF512hO5pEbeSgkm1nqrjS9X+DlpDEL4H0pfZFhwNj7ZoCE775u07272KJHZ8Ig0vbFc6QsohOJctm9FED0yVefpjrKvXACajFG/MUUF8FPAxAZ9IkJ4H1dNSJla5dca+91Lwu0L9me37C1XihMsR9m3M85s/Z+1/Os0fZ09kj4i1fXLa8TorWEKD+pBesFLbhVQ8Hb+2WXyCW5fLg87WNyh3VCTebjNwWHYWmfg7n9piBOoxmnq09mYloq04JqHsI+XECm2EXzEwfK2QcI0h8au7BhL30r4mGk8vMEd5h5RwoHKPaomB3n8rWcO3l4BB1FrTenJLZP2EZPKTGFQIaGZC0N4S99qotHXEipm+6xe9stqE+iMpzMtLuZaMfq5jz/BxIlwqTOjDRnDJIIBX5BozibZPCb0dWoajUf7yJApG2Uun+Zwc+K7IDSDPYOZ32VCYlWQBlvrhPyePDS68/XuwjfbaPt7OJNIzJupNCfoMzgblzu1g73bc9H8sjIDUFOxkGSir8xPbM/XHyF+esMLs2jD8u+1fGtvBP8jAizDPC9kln3SKLeD1TIaLW4+dV8ZovMaGlseWlTOvszmxTA=
  - secure: GGS3q/5VyCSNKvcWArNzmIriFphR9PXQFp2uHe+0vihUPoPUqHA9riBunOucgJva7/GYVPsr0T4h0xjmQSZM+K3VdTJUFyGDG2a7WqopSHipOqpxIeP8nie5ukUzfPdLwiOfZcKBNfYdkWyKqkLd0KtqMBGpWtIJgrpOy2HlHc1J6r81ACuSgB4BOdazNH7PzScGCrDWPzefcMHALCyZ603oiYHmsOHUEJeIRh2b5KbiUVYaHgodh5/sbH78ZXGnaCBt4gWqXqdB9hUfr1JlrG/x+HhUDr9QSWBEqCUx5gOu5E32KVndaj/WIgD8UlvX6eIJUXWQwGrlmJEnD6co9Z36wVYYhuIPvhsktlNp24uZ+M/kEHnUkXc0Mg9So0iHqrp2cpV88fNe/Luh+R78e0eh9cAz/smC6QDI9xeTtUi1aB1EdqVD/Dp71Lh6la9FgSTJqGP/j18nKWuoHRw3tfYYxxkWTrsCmd7A0sJdwNcOCdVcBw3JYCLqCPUtS0i5y/fJ4vGEGUBWAngYN9x9yrgauKcmXrqFdT4AmYCG3UcS6ioW1P8CNhsH+d6sUteORGQfMn8Z1JNGxuOU/IK3/tsNN/AfIVAxSS8PlHAI6VNaRD6QWl05dgVSYsf7K4ypLAJ5+btLCuqeyr+7U/lB9Qiwj1yIr4A9aUdQsIZdriw=
